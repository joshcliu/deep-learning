<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 180">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#555"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="850" height="180" fill="#fafafa"/>

  <!-- Title -->
  <text x="425" y="24" text-anchor="middle" font-family="Georgia, serif" font-size="15" font-weight="bold" fill="#333">Probing Pipeline</text>

  <!-- ===== 1. INPUT ===== -->
  <rect x="20" y="50" width="120" height="100" rx="8" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="80" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1565c0">Input</text>
  <text x="80" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#555">MMLU Question</text>
  <text x="80" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#777">+ 4 answer choices</text>
  <text x="80" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#999">~10K examples</text>

  <!-- Arrow 1→2 -->
  <line x1="140" y1="100" x2="170" y2="100" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ===== 2. MODEL ===== -->
  <rect x="175" y="50" width="150" height="100" rx="8" fill="#ede7f6" stroke="#512da8" stroke-width="2"/>
  <text x="250" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#4527a0">LLM (frozen)</text>
  <text x="250" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#555">Qwen2.5-7B</text>
  <line x1="195" y1="105" x2="305" y2="105" stroke="#9575cd" stroke-width="1"/>
  <text x="250" y="122" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#777">Extract hidden states</text>
  <text x="250" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#777">from layers 7, 14, 21, 27</text>

  <!-- Arrow 2→3 -->
  <line x1="325" y1="100" x2="355" y2="100" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ===== 3. PROBE ===== -->
  <rect x="360" y="50" width="140" height="100" rx="8" fill="#fff3e0" stroke="#ef6c00" stroke-width="2"/>
  <text x="430" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e65100">Probe</text>
  <text x="430" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#555">Linear / Hierarchical /</text>
  <text x="430" y="108" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#555">Sparse / Fusion</text>
  <line x1="380" y1="118" x2="480" y2="118" stroke="#ffb74d" stroke-width="1"/>
  <text x="430" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#777">Trainable classifier</text>

  <!-- Arrow 3→4 -->
  <line x1="500" y1="100" x2="530" y2="100" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ===== 4. OUTPUT ===== -->
  <rect x="535" y="50" width="120" height="100" rx="8" fill="#e8f5e9" stroke="#43a047" stroke-width="2"/>
  <text x="595" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">Confidence</text>
  <text x="595" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">p&#x0302; &#8712; [0,1]</text>
  <text x="595" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#777">P(model is correct)</text>
  <text x="595" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#999">sigmoid output</text>

  <!-- Arrow 4→5 -->
  <line x1="655" y1="100" x2="685" y2="100" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- ===== 5. EVALUATION ===== -->
  <rect x="690" y="50" width="140" height="100" rx="8" fill="#fce4ec" stroke="#c2185b" stroke-width="2"/>
  <text x="760" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#ad1457">Loss / Eval</text>
  <text x="760" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#555">Brier: (p&#x0302; - y)&#xB2;</text>
  <line x1="710" y1="105" x2="810" y2="105" stroke="#f48fb1" stroke-width="1"/>
  <text x="760" y="122" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#777">AUROC, ECE</text>
  <text x="760" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#777">10-fold CV</text>

  <!-- Bottom annotation -->
  <text x="425" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#888" font-style="italic">Train probe to predict whether the LLM answered correctly, using hidden states as input</text>
</svg>