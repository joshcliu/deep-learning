<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 500">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="750" height="500" fill="#f8f9fa"/>

  <!-- Title -->
  <text x="375" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">MultiSourceConfidenceNetwork Architecture</text>

  <!-- INPUT SECTION -->
  <text x="60" y="55" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#555">INPUTS</text>

  <!-- Hidden States Input -->
  <rect x="20" y="70" width="80" height="180" rx="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="60" y="90" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">Hidden</text>
  <text x="60" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">States</text>

  <!-- Layer boxes -->
  <rect x="30" y="120" width="60" height="25" rx="3" fill="#bbdefb" stroke="#1976d2"/>
  <text x="60" y="137" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">Layer 7</text>

  <rect x="30" y="150" width="60" height="25" rx="3" fill="#bbdefb" stroke="#1976d2"/>
  <text x="60" y="167" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">Layer 14</text>

  <rect x="30" y="180" width="60" height="25" rx="3" fill="#bbdefb" stroke="#1976d2"/>
  <text x="60" y="197" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">Layer 21</text>

  <rect x="30" y="210" width="60" height="25" rx="3" fill="#bbdefb" stroke="#1976d2"/>
  <text x="60" y="227" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">Layer 27</text>

  <!-- Logits Input -->
  <rect x="20" y="280" width="80" height="80" rx="5" fill="#fce4ec" stroke="#d81b60" stroke-width="2"/>
  <text x="60" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">Logits</text>
  <text x="60" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">[A,B,C,D]</text>
  <text x="60" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#999">4 choices</text>

  <!-- LAYER PROBES SECTION -->
  <rect x="130" y="60" width="120" height="200" rx="5" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
  <text x="190" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">Per-Layer Probes</text>

  <!-- Individual probes -->
  <rect x="145" y="95" width="90" height="35" rx="3" fill="#ffe0b2" stroke="#f57c00"/>
  <text x="190" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#333">MLP: 3584→64→32</text>
  <text x="190" y="122" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#666">+ ReLU + Dropout</text>

  <rect x="145" y="135" width="90" height="35" rx="3" fill="#ffe0b2" stroke="#f57c00"/>
  <text x="190" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#333">MLP: 3584→64→32</text>
  <text x="190" y="162" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#666">+ ReLU + Dropout</text>

  <rect x="145" y="175" width="90" height="35" rx="3" fill="#ffe0b2" stroke="#f57c00"/>
  <text x="190" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#333">MLP: 3584→64→32</text>
  <text x="190" y="202" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#666">+ ReLU + Dropout</text>

  <rect x="145" y="215" width="90" height="35" rx="3" fill="#ffe0b2" stroke="#f57c00"/>
  <text x="190" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#333">MLP: 3584→64→32</text>
  <text x="190" y="242" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#666">+ ReLU + Dropout</text>

  <!-- Arrows from hidden states to probes -->
  <line x1="100" y1="132" x2="140" y2="112" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="100" y1="162" x2="140" y2="152" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="100" y1="192" x2="140" y2="192" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="100" y1="222" x2="140" y2="232" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- CROSS-LAYER ATTENTION -->
  <rect x="280" y="60" width="120" height="200" rx="5" fill="#e8f5e9" stroke="#43a047" stroke-width="2"/>
  <text x="340" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">Cross-Layer</text>
  <text x="340" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">Attention</text>

  <!-- Attention visualization -->
  <rect x="295" y="110" width="90" height="70" rx="3" fill="#c8e6c9" stroke="#43a047"/>
  <text x="340" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">MultiHead</text>
  <text x="340" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">Attention</text>
  <text x="340" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">2 heads</text>

  <!-- Learned weights -->
  <rect x="295" y="190" width="90" height="55" rx="3" fill="#c8e6c9" stroke="#43a047"/>
  <text x="340" y="210" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">Learned</text>
  <text x="340" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">Layer Weights</text>
  <text x="340" y="238" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">w₁, w₂, w₃, w₄</text>

  <!-- Arrow from probes to attention -->
  <line x1="250" y1="160" x2="275" y2="160" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- LOGIT FEATURE EXTRACTION -->
  <rect x="130" y="275" width="120" height="90" rx="5" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="190" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">Logit Features</text>

  <text x="190" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">• Softmax probs</text>
  <text x="190" y="330" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">• Entropy H(p)</text>
  <text x="190" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">• Margin Δ = p₁-p₂</text>
  <text x="190" y="360" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">• Max prob</text>

  <!-- Arrow from logits to features -->
  <line x1="100" y1="320" x2="125" y2="320" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- LOGIT PROCESSOR -->
  <rect x="280" y="280" width="120" height="80" rx="5" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="340" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">Logit Processor</text>
  <text x="340" y="325" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">MLP: 7→64→32</text>
  <text x="340" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">+ ReLU + Dropout</text>

  <!-- Arrow from features to processor -->
  <line x1="250" y1="320" x2="275" y2="320" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- FUSION SECTION -->
  <rect x="430" y="120" width="130" height="220" rx="5" fill="#ede7f6" stroke="#512da8" stroke-width="2"/>
  <text x="495" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Fusion Network</text>

  <!-- Concat -->
  <rect x="445" y="165" width="100" height="40" rx="3" fill="#d1c4e9" stroke="#512da8"/>
  <text x="495" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">Concatenate</text>
  <text x="495" y="198" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">[hidden; logits]</text>

  <!-- MLP layers -->
  <rect x="445" y="215" width="100" height="30" rx="3" fill="#d1c4e9" stroke="#512da8"/>
  <text x="495" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#333">Linear(64→128)</text>

  <rect x="445" y="250" width="100" height="30" rx="3" fill="#d1c4e9" stroke="#512da8"/>
  <text x="495" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#333">Linear(128→64)</text>

  <rect x="445" y="285" width="100" height="30" rx="3" fill="#d1c4e9" stroke="#512da8"/>
  <text x="495" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#333">Linear(64→1)</text>

  <!-- Arrows to fusion -->
  <line x1="400" y1="160" x2="425" y2="185" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="400" y1="320" x2="425" y2="185" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- OUTPUT -->
  <rect x="590" y="200" width="130" height="80" rx="5" fill="#e0f2f1" stroke="#00796b" stroke-width="2"/>
  <text x="655" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Sigmoid</text>
  <text x="655" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#333">p̂ ∈ [0, 1]</text>
  <text x="655" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Confidence Score</text>

  <!-- Arrow to output -->
  <line x1="560" y1="240" x2="585" y2="240" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- KEY INSIGHT BOX -->
  <rect x="430" y="380" width="290" height="100" rx="8" fill="#fff8e1" stroke="#f9a825" stroke-width="2"/>
  <text x="575" y="405" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">Key Insight</text>
  <text x="575" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#555">Detects miscalibration by comparing:</text>
  <text x="575" y="445" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">• Internal uncertainty (hidden states)</text>
  <text x="575" y="460" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">• Expressed confidence (logits)</text>

  <!-- PARAMETER COUNT -->
  <rect x="20" y="400" width="150" height="80" rx="5" fill="#eceff1" stroke="#607d8b" stroke-width="1"/>
  <text x="95" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">Parameters</text>
  <text x="95" y="440" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">~100K trainable</text>
  <text x="95" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#999">(vs 7B in LLM)</text>
  <text x="95" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#999">Low overfitting risk</text>
</svg>