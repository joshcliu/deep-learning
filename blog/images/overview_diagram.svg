<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="800" height="400" fill="#f8f9fa"/>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">Confidence Probing Pipeline</text>

  <!-- Input Question Box -->
  <rect x="30" y="80" width="120" height="80" rx="8" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="90" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">MMLU</text>
  <text x="90" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Question</text>

  <!-- Arrow 1 -->
  <line x1="150" y1="120" x2="190" y2="120" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- LLM Box -->
  <rect x="200" y="60" width="140" height="120" rx="8" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
  <text x="270" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Qwen2.5-7B</text>
  <text x="270" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#666">28 layers</text>
  <text x="270" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#666">3584 hidden dim</text>
  <text x="270" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#999">8-bit quantized</text>

  <!-- Arrow 2 (splits) -->
  <line x1="340" y1="100" x2="390" y2="70" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="340" y1="140" x2="390" y2="170" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Hidden States Box -->
  <rect x="400" y="40" width="130" height="70" rx="8" fill="#e8f5e9" stroke="#43a047" stroke-width="2"/>
  <text x="465" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Hidden States</text>
  <text x="465" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Layers [7,14,21,27]</text>
  <text x="465" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Last token position</text>

  <!-- Logits Box -->
  <rect x="400" y="130" width="130" height="70" rx="8" fill="#fce4ec" stroke="#d81b60" stroke-width="2"/>
  <text x="465" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Output Logits</text>
  <text x="465" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">A, B, C, D probs</text>
  <text x="465" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Entropy, Margin</text>

  <!-- Arrow 3 (merges) -->
  <line x1="530" y1="75" x2="580" y2="120" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="530" y1="165" x2="580" y2="120" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Probe Box -->
  <rect x="590" y="80" width="140" height="80" rx="8" fill="#ede7f6" stroke="#7b1fa2" stroke-width="2"/>
  <text x="660" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">MultiSource</text>
  <text x="660" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">Confidence</text>
  <text x="660" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">Network</text>
  <text x="660" y="152" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Brier loss training</text>

  <!-- Arrow 4 -->
  <line x1="730" y1="120" x2="770" y2="120" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Output -->
  <text x="785" y="115" text-anchor="start" font-family="Arial, sans-serif" font-size="12" fill="#333">p̂</text>
  <text x="785" y="130" text-anchor="start" font-family="Arial, sans-serif" font-size="10" fill="#666">∈[0,1]</text>

  <!-- Ground Truth Flow -->
  <rect x="30" y="250" width="120" height="60" rx="8" fill="#ffebee" stroke="#c62828" stroke-width="2"/>
  <text x="90" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Ground Truth</text>
  <text x="90" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Correct Answer</text>

  <!-- Compare Box -->
  <rect x="200" y="250" width="120" height="60" rx="8" fill="#fff8e1" stroke="#ff8f00" stroke-width="2"/>
  <text x="260" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Compare</text>
  <text x="260" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Model vs Truth</text>

  <!-- Label Box -->
  <rect x="370" y="250" width="120" height="60" rx="8" fill="#e0f7fa" stroke="#00838f" stroke-width="2"/>
  <text x="430" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Binary Label</text>
  <text x="430" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">y ∈ {0, 1}</text>

  <!-- Arrows for bottom flow -->
  <line x1="150" y1="280" x2="190" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="320" y1="280" x2="360" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="490" y1="280" x2="590" y2="200" stroke="#333" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead)"/>

  <!-- Training label -->
  <text x="545" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666" font-style="italic">supervision</text>

  <!-- Legend -->
  <text x="650" y="280" text-anchor="start" font-family="Arial, sans-serif" font-size="11" fill="#333" font-weight="bold">Key Insight:</text>
  <text x="650" y="300" text-anchor="start" font-family="Arial, sans-serif" font-size="10" fill="#666">Probe learns to predict</text>
  <text x="650" y="315" text-anchor="start" font-family="Arial, sans-serif" font-size="10" fill="#666">correctness from hidden</text>
  <text x="650" y="330" text-anchor="start" font-family="Arial, sans-serif" font-size="10" fill="#666">states + logits</text>
</svg>